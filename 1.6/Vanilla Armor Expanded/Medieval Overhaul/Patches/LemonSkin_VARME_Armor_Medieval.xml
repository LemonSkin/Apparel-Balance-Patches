<?xml version="1.0" encoding="utf-8"?>
<Patch>
  <!-- Chainmail -->
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chainmail"]/label</xpath>
    <value>
      <label>light hauberk</label>
    </value>
  </Operation>
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chainmail"]/recipeMaker/recipeUsers</xpath>
    <order>Append</order>
    <value>
      <li>DankPyon_Anvil</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chainmail"]/recipeMaker/skillRequirements/Crafting</xpath>
    <value>
      <Crafting>6</Crafting>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chainmail"]/costStuffCount</xpath>
    <value>
      <costStuffCount>50</costStuffCount>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chainmail"]/statBases</xpath>
    <value>
      <statBases>
        <WorkToMake>10000</WorkToMake>
        <MaxHitPoints>200</MaxHitPoints>
        <Mass>2</Mass>
        <StuffEffectMultiplierArmor>0.46</StuffEffectMultiplierArmor>
        <StuffEffectMultiplierInsulation_Cold>0.05</StuffEffectMultiplierInsulation_Cold>
        <StuffEffectMultiplierInsulation_Heat>0.05</StuffEffectMultiplierInsulation_Heat>
        <EquipDelay>4</EquipDelay>
      </statBases>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chainmail"]/apparel/bodyPartGroups</xpath>
    <value>
      <bodyPartGroups>
        <li>Torso</li>
        <li>Shoulders</li>
      </bodyPartGroups>
    </value>
  </Operation>
  <!-- Light Plate Armor -->
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_LightPlateArmor"]/recipeMaker/recipeUsers</xpath>
    <order>Append</order>
    <value>
      <li>DankPyon_Anvil</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_LightPlateArmor"]/costStuffCount</xpath>
    <value>
      <costStuffCount>150</costStuffCount>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_LightPlateArmor"]/statBases</xpath>
    <value>
      <statBases>
        <WorkToMake>22000</WorkToMake>
        <MaxHitPoints>230</MaxHitPoints>
        <Mass>12</Mass>
        <StuffEffectMultiplierArmor>0.67</StuffEffectMultiplierArmor>
        <StuffEffectMultiplierInsulation_Cold>0.15</StuffEffectMultiplierInsulation_Cold>
        <StuffEffectMultiplierInsulation_Heat>0.0</StuffEffectMultiplierInsulation_Heat>
        <EquipDelay>10</EquipDelay>
      </statBases>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_LightPlateArmor"]/equippedStatOffsets</xpath>
    <value>
      <equippedStatOffsets>
        <MoveSpeed>-0.4</MoveSpeed>
      </equippedStatOffsets>
    </value>
  </Operation>
  <!-- Plate Shoulderpads -->
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateShoulderpads"]/recipeMaker/recipeUsers</xpath>
    <order>Append</order>
    <value>
      <li>DankPyon_Anvil</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateShoulderpads"]/recipeMaker/skillRequirements/Crafting</xpath>
    <value>
      <Crafting>9</Crafting>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateShoulderpads"]/statBases</xpath>
    <value>
      <statBases>
        <WorkToMake>7200</WorkToMake>
        <MaxHitPoints>250</MaxHitPoints>
        <Mass>2</Mass>
        <StuffEffectMultiplierArmor>0.78</StuffEffectMultiplierArmor>
        <StuffEffectMultiplierInsulation_Cold>0.15</StuffEffectMultiplierInsulation_Cold>
        <StuffEffectMultiplierInsulation_Heat>0</StuffEffectMultiplierInsulation_Heat>
        <EquipDelay>2</EquipDelay>
      </statBases>
    </value>
  </Operation>
  <!-- Plate Helmet -->
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateHelmet"]/recipeMaker/recipeUsers</xpath>
    <order>Append</order>
    <value>
      <li>DankPyon_Anvil</li>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateHelmet"]/recipeMaker/skillRequirements/Crafting</xpath>
    <value>
      <Crafting>7</Crafting>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateHelmet"]/costStuffCount</xpath>
    <value>
      <costStuffCount>70</costStuffCount>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateHelmet"]/statBases</xpath>
    <value>
      <statBases>
        <WorkToMake>14600</WorkToMake>
        <MaxHitPoints>140</MaxHitPoints>
        <Mass>3.5</Mass>
        <StuffEffectMultiplierArmor>0.72</StuffEffectMultiplierArmor>
        <StuffEffectMultiplierInsulation_Cold>0.15</StuffEffectMultiplierInsulation_Cold>
        <StuffEffectMultiplierInsulation_Heat>0</StuffEffectMultiplierInsulation_Heat>
        <EquipDelay>2.5</EquipDelay>
      </statBases>
    </value>
  </Operation>
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_PlateHelmet"]/equippedStatOffsets</xpath>
    <value>
      <equippedStatOffsets>
        <ShootingAccuracyPawn>-6</ShootingAccuracyPawn>
      </equippedStatOffsets>
    </value>
  </Operation>
  <!-- Remove tings -->
  <Operation Class="PatchOperationRemove">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Chestplate"]</xpath>
  </Operation>
  <Operation Class="PatchOperationRemove">
    <xpath>Defs/ThingDef[defName="VAE_Handwear_PlateGloves"]</xpath>
  </Operation>
  <!-- Fix VARME Royalty patch before removing VARME plate boots -->
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Full Armor - Hands and Feet</li>
      <li>Combat Extended</li>
    </mods>
    <nomatch Class="PatchOperationReplace">
      <xpath>/Defs/PawnKindDef[@Name="ImperialFighterBase"]/apparelRequired/li[.="VAE_Footwear_PlateBoots"]</xpath>
      <value>
        <li>DankPyon_Footwear_BootsPlate</li>
      </value>
    </nomatch>
  </Operation>
  <Operation Class="PatchOperationRemove">
    <xpath>Defs/ThingDef[defName="VAE_Footwear_PlateBoots"]</xpath>
  </Operation>
  <Operation Class="PatchOperationRemove">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_QuiltedVest"]</xpath>
  </Operation>
  <Operation Class="PatchOperationRemove">
    <xpath>Defs/ThingDef[defName="VAE_Apparel_Gambeson"]</xpath>
  </Operation>
  <!-- Rewire military clothing if it exists and then delete VAE LeatherTanning research -->
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Vanilla Apparel Expanded</li>
    </mods>
    <nomatch Class="PatchOperationRemove">
      <xpath>Defs/ResearchProjectDef[defName="VAE_MilitaryClothing"]/prerequisites</xpath>
      <success>Always</success>
    </nomatch>
  </Operation>
  <Operation Class="PatchOperationRemove">
    <xpath>Defs/ResearchProjectDef[defName="VAE_LeatherTanning"]</xpath>
  </Operation>
</Patch>
